<div class="content">
  <h1>Posts</h1>

  <% @posts.includes(:user).each do |post| %>
    <% next unless current_user.active_friends.include?(post.user) || current_user.posts.include?(post) %>
      <div class="box">
      <h2 class="title"><%= post.user.name %></h2>
      <h3 class="subtitle is-7"><%= post.created_at.strftime('%B %d, %Y') %></h3>
      <p><%= post.body %></p>
      <% if current_user.liked_posts.include?(post) %>
        <%= simple_form_for :unlike, url: like_path(current_user.likes.find_by_post_id(post.id)), method: :delete do |f| %>
          <%= button_tag type: 'submit', class: "is-info button" do %>
            <span class="icon-text">
              <span class="icon">
                <i class="fa fa-thumbs-up"></i>
              </span>
              <span><%= post.likes.count %></span>
            </span>
          <% end %>
        <% end %>
      <% else %>
        <%= simple_form_for :like, url: likes_path, method: :post do |f| %>
          <%= f.hidden_field :post_id, value: post.id %>
          <%= button_tag type: 'submit', class: "is-info is-outlined button" do %>
            <span class="icon-text">
              <span class="icon">
                <i class="fa fa-thumbs-up"></i>
              </span>
              <span><%= post.likes.count %></span>
            </span>
          <% end %>
        <% end %>
      <% end %>
      <%= link_to 'View Comments', post %>
    </div>
  <% end %>
</div>
